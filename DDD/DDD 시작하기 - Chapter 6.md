# 응용 서비스와 표현 영역
- 웅용 서비스 구현
- 표현 영역의 역할
- 값 검증과 권한 검사

## 표현 영역과 응용 영역
- 도메인이 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요
  - 매개체 역할 → 표현 영역, 응용 영역
- 표현 영역은 사용자의 요청을 해석
- 실제 사용자가 원하는 기능을 제공하는 것은 응용 영역에 위치한 서비스
- 사용자와 상호작용은 표현 영역이 처리하기 때문에, 응용 서비스는 표현 영역에 의존하지 않음

## 응용 서비스의 역할
- 응용 서비스의 주요 역할은 도메인 객체를 사용해서 사용자의 요청을 처리하는 것
- 표현(사용자) 영역 입장에서 보았을 때 응용 서비스는 도메인 영역과 표현 영역을 연결해 주는 창구 역할
- 응용 서비스는 주로 도메인 객체 간의 흐름을 제어하기 때문에 단순한 형태를 가짐
- 응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성이 높음
  - 응용 서비스가 도메인 로직을 일부 구현하면 코드 중복, 로직 분산 등 코드 품질에 안 좋은 영향을 줄 수 있음
- 응용 서비스는 트랜잭션 처리도 담당
  - 도메인의 상태 변경을 트랜잭션으로 처리해야 함
- 도메인 로직 넣지 않기
  - 도메인 로직을 도메인 영역과 응용 서비스에 분산해서 구현하면 코드 품질에 문제가 발생함
    - 첫 번째 문제 → 코드의 응집성이 떨어짐
      - 도메인 데이터와 그 데이터를 조작하는 도메인 로직이 한 영역에 위치하지 않고 서로 다른 영역에 위치한다는 것은 도메인 로직을 파악하기 위해 여러 영역을 분석해야 한다는 것을 의미
    - 두 번째 문제 → 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아짐
      - 코드 중복을 막기 위해 응용 서비스 영역에 별도의 보조 클래스를 만들 수 있지만, 애초에 도메인 영역에 구현했으면 응용 서비스는 그 기능을 사용하기만 하면 됨
    - 결과적으로 코드 변경을 어렵게 만듦

## 응용 서비스의 구현
- 응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할 → 디자인 패턴에서 파사드(facade)와 같은 역할
- 응용 서비스의 크기
  - 응용 서비스는 보통 다음 두 가지 방법 중 한 가지 방식으로 구현
    - 한 응용 서비스 클래스에 도메인의 모든 기능 구현
    - 구분되는 기능별로 응용 서비스 클래스를 따로 구현
- 응용 서비스의 인터페이스와 클래스
  - 응용 서비스를 구현할 때 논쟁이 될 만한 것 → '인터페이스가 필요한 지'
  - 인터페이스가 명확하게 필요하기 전까지는 응용 서비스에 대한 인터페이스를 작성하는 것이 좋은 선택이라고 볼 수는 없음
- 메서드 파라미터와 값 리턴
  - 스프링 MVC와 같은 웹 프레임워크는 웹 요청 파라미터를 자바 객체로 변환하는 기능을 제공하므로 응용 서비스에 데이터로 전달할 요청 파라미터가 두 개 이상 존재하면 데이터 전달을 위한 별도 클래스를 사용하는 것이 편리
- 표현 영역에 의존하지 않기
  - 응용 서비스의 파라미터 타입을 결정할 때 주의할 점은 표현 영역과 관련된 타입을 사용하면 안 된다는 점
    - 응용 서비스에서 표현 영역에 대한 의존이 발생하면 응용 서비스만 단독으로 테스트하기가 어려워짐
    - 표현 영역의 구현이 변경되면 응용 서비스의 구현도 함께 변경해야 하는 문제도 발생
    - 더 심각한 것은 응용 서비스가 표현 영역의 역할까지 대신하는 상황이 벌어질 수도 있다는 것
- 트랜잭션 처리
  - 트랜잭션을 관리하는 것은 응용 서비스의 중요한 역할
  - 스프링과 같은 프레임워크가 제공하는 트랜잭션 관리 기능을 이용하면 쉽게 트랜잭션을 처리할 수 있음
    - 프레임워크가 제공하는 트랜잭션 기능을 적극 사용하는 것이 좋음
    - 간단한 설정만으로 트랜잭션을 시작하여 커밋하고 익셉션이 발생하면 롤백할 수 있음

## 표현 영역
- 표현 영역의 책임
  - 사용자가 시스템을 사용할 수 있는 흐름(화면)을 제공하고 제어
  - 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공
  - 사용자의 세션을 관리

## 값 검증
- 값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있음
  - 원칙적으로 모든 값에 대한 검증은 응용 서비스에서 처리
  - 표현 영역은 잘못된 값이 존재하면 이를 사용자에게 알려주고 값을 다시 입력받아야 함
- 스프링과 같은 프레임워크는 값 검증을 위한 Validator 인터페이스를 별도로 제공하므로 이 인터페이스를 구현한 검증기를 따로 구현하면 코드를 간결하게 줄일 수 있음
- 위 방식으로 표현 영역에서 필수 값과 값의 형식을 검사하면 실질적으로 응요 서비스는 ID 중복 여부와 같은 논리적 오류만 검사하면 됨
  - 즉, 표현 영역과 응용 서비스가 값 검사를 나눠서 수행하는 것
- 응용 서비스에서 얼마나 엄격하게 값을 검증해야 하는지에 대해서는 의견이 갈릴 수 있음

## 권한 검사
- 보통 다음 세 곳에서 권한 검사를 수행할 수 있음
  - 표현 영역
  - 응용 서비스
  - 도메인
- 표현 영역에서 할 수 있는 기본적인 검사는 인증된 사용자인지 아닌지 검사하는 것
  - 이런 접근 제어를 하기에 좋은 위치가 서블릿 필터
    - 서블릿 필터에서 사용자의 인증 정보를 생성하고 인증 여부를 검사
- URL 만으로 접근 제어를 할 수 없는 경우 응용 서비스의 메서드 단위로 권한 검사를 수행해야 함
  - 이것이 꼭 응용 서비스의 코드에서 직접 권한 검사를 해야 한다는 것을 의미하는 것은 아님
- 개별 도메인 객체 단위로 권한 검사를 해야 하는 경우는 구현이 복잡해짐

## 조회 전용 기능과 응용 서비스
- 응용 서비스가 사용자 요청 기능을 실행하는 데 별다른 기여를 하지 못한다면 굳이 서비스를 만들지 않아도 됨
  - 조회를 위한 응용 서비스가 단지 조회 전용 기능을 실행하는 코드밖에 없다면 응용 서비스를 생략해도 무방함